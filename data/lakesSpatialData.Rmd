Create Spatial Objects for Waterbodies in HUC regions 01, 02, and 03
========================================================
Spatial Data
-------------------------
* read the nhdwaterbody.shp files for the three regions
* identify and remove duplicate lakes
* merge lakes from the regions
* dissolve based on reachcode-output= SpatialPolygonsDataframe "lakes" with geographic coordinates
* get the centroids and convert to spdf with reachcode (WBRCHCODE) as an attribute. output= SpatialPointsDataframe "lakes" with geographic coordinates
* save "lakes" and "lakesPt"

************
The following code will open the formatted text version of the Rmarkdown file in a browser:
************
    browseURL('https://github.com/willbmisled/ECsparrow/blob/master/data/lakesSpatialData.md')
************
The data can be loaded into R with the following code:
************
  #Get the Data
    load(url('https://raw.github.com/willbmisled/ECsparrow/master/data/lakesSpatialData.rda')



```{r loadPkgs, include=FALSE, echo=FALSE, cache=FALSE}
  options(stringsAsFactors = FALSE, scipen=9) 


  #function to install (if needed) and load R packages by list
    libs<-c('rgdal','maptools','RODBC') #list of packages to load
  
    installLoad<-function(pck)#user defined function
    {
      if(!pck%in%installed.packages()){install.packages(pck,repos="http://rweb.quant.ku.edu/cran/")}
      require(pck, character.only = TRUE)
    }
  
    lapply(libs,function(x) installLoad(x))  #Load/Install require packages
```



```{r lakes, include=FALSE, echo=FALSE, cache=FALSE}
#set working directory
  setwd('../data')

#Get the NHDplus shapefiles for HUC regions 01,02, and 03
  HUC01<-readShapePoly('C:/Bryan/EPA/Data/GIS/NHDPlus/NHDPlus01/hydrography/nhdwaterbody.shp',IDvar="COMID", 
                      proj4string=CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,06"))
  HUC02<-readShapePoly('C:/Bryan/EPA/Data/GIS/NHDPlus/NHDPlus02/hydrography/nhdwaterbody.shp',IDvar="COMID", 
                      proj4string=CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,06"))
  HUC03<-readShapePoly('C:/Bryan/EPA/Data/GIS/NHDPlus/NHDPlus03/hydrography/nhdwaterbody.shp',IDvar="COMID", 
                      proj4string=CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,06"))
#check to see if lakes are repeated
  w<-row.names(as(HUC01, "data.frame"))
  x<-row.names(as(HUC02, "data.frame"))
  y<-row.names(as(HUC03, "data.frame"))
  
  table(w%in%x)
    w[w%in%x]
  table(w%in%y)  #no matches
  table(x%in%y)  #"7711214" "7713434"
    x[x%in%y]    #"11585128" "11585144" "11585356"
#eliminate duplicate lakes
    nrow(HUC01) #17084
      HUC01<-HUC01[-which(w%in%x),]
        nrow(HUC01) #17082
    nrow(HUC02) #20108
      HUC02<-HUC02[-which(x%in%y),]
        nrow(HUC02) #20105
#merge the three layers
  WB<-spRbind(HUC01,HUC02)
  WB<-spRbind(WB,HUC03)
    nrow(WB)==nrow(HUC01)+nrow(HUC02)+nrow(HUC03)
#dissolve the polygons by REACHCODE
  length(WB$REACHCODE) #120377
  length(unique(WB$REACHCODE)) #87244
    lakes<-unionSpatialPolygons(WB, WB$REACHCODE)
#convert to SpatialPolygonsDataframe with reachcode as an attribute
  data<-data.frame(WBRCHCODE=row.names(lakes))  #the reachcodes
    row.names(data)<-row.names(lakes)
  lakes<-SpatialPolygonsDataFrame(lakes,data=data)
#Associate lake holes (islands) with the correct polygon.  This is an important step.
  slot(lakes, "polygons") <- lapply(slot(lakes, "polygons"), checkPolygonsHoles)
#create spatial points dataframe of lake centroids
  lakesPt<-gCentroid(lakes, byid=TRUE, id = NULL)  #reachcodes are the row.names for the spatialpoints object
#convert to spatial points data.frame
  coords<-coordinates(lakesPt)  #the centroids
  data<-data.frame(WBRCHCODE=row.names(lakesPt))  #the reachcodes
      row.names(data)<-row.names(lakesPt)
  lakesPt<-SpatialPointsDataFrame(coords, data)  #convert to spdf

#save the data
  save(lakes,lakesPt,file='../lakesSpatialData.rda')
```

