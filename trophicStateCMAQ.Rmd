Title
========================================================




```{r loadPkgs, include=FALSE, echo=FALSE, cache=FALSE}
  options(stringsAsFactors = FALSE, scipen=9) 


  #function to install (if needed) and load R packages by list
    libs<-c('rgdal','maptools','RODBC') #list of packages to load
  
    installLoad<-function(pck)#user defined function
    {
      if(!pck%in%installed.packages()){install.packages(pck,repos="http://rweb.quant.ku.edu/cran/")}
      require(pck, character.only = TRUE)
    }
  
    lapply(libs,function(x) installLoad(x))  #Load/Install require packages
```

Spatial Data
-------------------------
**Create a spatialpointsdataframe of lake centroids for HUC regions 01, 02, and 03**
* read the nhdwaterbody.shp files for the three regions
* identify and remove duplicate lakes
* merge lakes from the regions
* dissolve based on reachcode
* get the centroids and convert to spdf with reachcode (WBRCHCODE) as an attribute.

```{r lakePt, include=FALSE, echo=FALSE, cache=FALSE}
#Get the NHDplus shapefiles for HUC regions 01,02, and 03
  HUC01<-readShapePoly('C:/Bryan/EPA/Data/GIS/NHDPlus/NHDPlus01/hydrography/nhdwaterbody.shp',IDvar="COMID", 
                      proj4string=CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,06"))
  HUC02<-readShapePoly('C:/Bryan/EPA/Data/GIS/NHDPlus/NHDPlus02/hydrography/nhdwaterbody.shp',IDvar="COMID", 
                      proj4string=CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,06"))
  HUC03<-readShapePoly('C:/Bryan/EPA/Data/GIS/NHDPlus/NHDPlus03/hydrography/nhdwaterbody.shp',IDvar="COMID", 
                      proj4string=CRS("+proj=longlat +datum=NAD83 +no_defs +ellps=GRS80 +towgs84=0,0,06"))
#check to see if lakes are repeated
  w<-row.names(as(HUC01, "data.frame"))
  x<-row.names(as(HUC02, "data.frame"))
  y<-row.names(as(HUC03, "data.frame"))
  
  table(w%in%x)
    w[w%in%x]
  table(w%in%y)  #no matches
  table(x%in%y)  #"7711214" "7713434"
    x[x%in%y]    #"11585128" "11585144" "11585356"
#eliminate duplicate lakes
    nrow(HUC01) #17084
      HUC01<-HUC01[-which(w%in%x),]
        nrow(HUC01) #17082
    nrow(HUC02) #20108
      HUC02<-HUC02[-which(x%in%y),]
        nrow(HUC02) #20105
#merge the three layers
  WB<-spRbind(HUC01,HUC02)
  WB<-spRbind(WB,HUC03)
    nrow(WB)==nrow(HUC01)+nrow(HUC02)+nrow(HUC03)
#dissolve the polygons by REACHCODE
  length(WB$REACHCODE) #120377
  length(unique(WB$REACHCODE)) #87244
    lakes<-unionSpatialPolygons(WB, WB$REACHCODE)
      getSlots(class(lakes))
      nrow(lakes@data)
        z<-row.names(as(lakes, "data.frame"))
#create spatial points dataframe of lake centroids
  lakePt<-gCentroid(lakes, byid=TRUE, id = NULL)  #reachcodes are the row.names for the spatialpoints object
#convert to spatial points data.frame
  coords<-coordinates(lakePt)  #the centroids
  data<-data.frame(WBRCHCODE=row.names(lakePt))  #the reachcodes
      row.names(data)<-row.names(lakePt)
  lakePt<-SpatialPointsDataFrame(coords, data)  #convert to spdf
```



# Read data-****Make Sure the Path Is Correct****
  con <- odbcConnectAccess('C:/Bryan/EPA/Data/Sparrow/EastCoast/EC2014.mdb')
   L2002 <- sqlQuery(con, "SELECT mrb1_massbalancereservoirs_2002.* FROM mrb1_massbalancereservoirs_2002")
   L2020 <- sqlQuery(con, "SELECT mrb1_massbalancereservoirs_2020.* FROM mrb1_massbalancereservoirs_2020")
  close(con)
  
